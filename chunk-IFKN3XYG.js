import{a as B,b as z,c as _,d as G,e as O,f as j,g as L,h as J,i as K,j as Q,k as W,l as X}from"./chunk-CTWLBV5P.js";import{B as H,G as T,H as I,Ia as U,Ka as R,Oa as A,Q as V,Qa as q,R as m,S as M,Ta as k,W as P,Y as v,_ as u,fa as i,ga as n,ha as f,ka as D,la as h,ma as b,ua as a,xa as N,z as w}from"./chunk-HEL3WMYV.js";function Y(o,s){if(o&1){let c=D();i(0,"div",28),f(1,"img",29),i(2,"button",30),h("click",function(){T(c);let t=b();return I(t.removeImage("image"))}),a(3,"Remover"),n()()}if(o&2){let c=b();m(),u("src",c.imagePreviews.image,V)}}function Z(o,s){o&1&&(i(0,"div",31),a(1," Imagem-Capa \xE9 obrigat\xF3ria. "),n())}function $(o,s){if(o&1){let c=D();i(0,"div",28),f(1,"img",29),i(2,"button",30),h("click",function(){T(c);let t=b();return I(t.removeImage("carousel1"))}),a(3,"Remover"),n()()}if(o&2){let c=b();m(),u("src",c.imagePreviews.carousel1,V)}}function ee(o,s){o&1&&(i(0,"div",31),a(1," Carrosel-1 \xE9 obrigat\xF3rio. "),n())}function te(o,s){if(o&1){let c=D();i(0,"div",28),f(1,"img",29),i(2,"button",30),h("click",function(){T(c);let t=b();return I(t.removeImage("carousel2"))}),a(3,"Remover"),n()()}if(o&2){let c=b();m(),u("src",c.imagePreviews.carousel2,V)}}function ne(o,s){o&1&&(i(0,"div",31),a(1," Carrosel-2 \xE9 obrigat\xF3rio. "),n())}function ie(o,s){if(o&1){let c=D();i(0,"div",28),f(1,"img",29),i(2,"button",30),h("click",function(){T(c);let t=b();return I(t.removeImage("carousel3"))}),a(3,"Remover"),n()()}if(o&2){let c=b();m(),u("src",c.imagePreviews.carousel3,V)}}function oe(o,s){o&1&&(i(0,"div",31),a(1," Carrosel-3 \xE9 obrigat\xF3rio. "),n())}function re(o,s){o&1&&(i(0,"div",31),a(1," Hist\xF3rico \xE9 obrigat\xF3rio. "),n())}function ae(o,s){o&1&&(i(0,"div",31),a(1," Endere\xE7o \xE9 obrigat\xF3rio. "),n())}function le(o,s){o&1&&(i(0,"div",31),a(1," Entrada \xE9 obrigat\xF3ria. "),n())}function me(o,s){o&1&&(i(0,"div",31),a(1," Hor\xE1rio de Funcionamento \xE9 obrigat\xF3rio. "),n())}function ue(o,s){o&1&&(i(0,"div",31),a(1," O t\xEDtulo do card \xE9 obrigat\xF3rio. "),n())}function se(o,s){o&1&&(i(0,"div",31),a(1," Descri\xE7\xE3o do card \xE9 obrigat\xF3ria. "),n())}var ye=(()=>{let s=class s{constructor(r){this.fb=r,this.monumentoService=w(B),this.notificacaoService=w(W),this.cardService=w(X),this.router=w(q),this.imagePreviews={},this.monumento=P(w(A).snapshot.data.monumento||[]),this.monumentForm=this.fb.group({image:[null,_.required],carousel1:[null,_.required],carousel2:[null,_.required],carousel3:[null,_.required],history:["",_.required],address:["",_.required],entryFee:["",_.required],openingHours:["",_.required],titulo:["",_.required],descricao:["",_.required]})}ngOnInit(){this.monumento()&&this.loadMonumentData()}loadMonumentData(){this.monumentForm.patchValue({image:this.base64ToFile(this.monumento().imagemPrincipal,"ImagemCapa"),carousel1:this.base64ToFile(this.monumento().carrosel1,"Carrosel1"),carousel2:this.base64ToFile(this.monumento().carrosel2,"Carrosel2"),carousel3:this.base64ToFile(this.monumento().carrosel3,"Carrosel3"),history:this.monumento().contextoHistorico,address:this.monumento().endereco,entryFee:this.monumento().entrada,openingHours:this.monumento().horarioFuncionamento,titulo:this.monumento().card.titulo,descricao:this.monumento().card.descricao}),this.imagePreviews={image:this.base64ToBlobUrl("data:image/png;base64,"+this.monumento().imagemPrincipal),carousel1:this.base64ToBlobUrl("data:image/png;base64,"+this.monumento().carrosel1),carousel2:this.base64ToBlobUrl("data:image/png;base64,"+this.monumento().carrosel2),carousel3:this.base64ToBlobUrl("data:image/png;base64,"+this.monumento().carrosel3)}}base64ToFile(r,t){let e=atob(r),l=new Array(e.length);for(let p=0;p<e.length;p++)l[p]=e.charCodeAt(p);let d=new Uint8Array(l);return new File([d],t,{type:"image/png"})}base64ToBlobUrl(r){let t="base64,",e=r.indexOf(t)+t.length,l=r.substring(e),d=window.atob(l),p=d.length,E=new Uint8Array(p);for(let g=0;g<p;g++)E[g]=d.charCodeAt(g);let F=new Blob([E],{type:"image/png"});return URL.createObjectURL(F)}onSubmit(){if(!this.monumentForm.valid)return;let r=this.collectMonumentFormData();this.monumentoService.updateMonumento(r).subscribe({next:t=>{this.handleMonumentCreationSuccess(t)},error:t=>{console.error("Error:",t)}})}collectMonumentFormData(){let r=this.monumentForm.value,t=new FormData;return t.append("id",this.monumento().id),t.append("history",r.history),t.append("address",r.address),t.append("openingHours",r.openingHours),t.append("entryFee",r.entryFee),t.append("carousel1",r.carousel1),t.append("carousel2",r.carousel2),t.append("carousel3",r.carousel3),t.append("image",r.image),t}handleMonumentCreationSuccess(r){let t=this.prepareCardFormData(r);this.cardService.updateCard(t).subscribe({next:e=>{this.handleCardCreationSuccess()},error:e=>{console.error("Error creating card:",e)}})}prepareCardFormData(r){let t=this.monumentForm.value,e=new FormData;return e.append("id",this.monumento().card.id.toString()),e.append("descricao",t.descricao),e.append("titulo",t.titulo),e.append("imagem",t.image),e.append("monumentoId",this.monumento().id),e}handleCardCreationSuccess(){this.notificacaoService.show({text:"Edi\xE7\xE3o realizada com sucesso",classname:"bg-success text-light",delay:2e3}),this.router.navigate(["/"])}onFileChange(r,t){let e=r.target.files?.[0];if(e){this.monumentForm.patchValue({[t]:e}),this.monumentForm.get(t)?.updateValueAndValidity();let l=new FileReader;l.onload=()=>{l.result&&(this.imagePreviews[t]=l.result)},l.readAsDataURL(e)}}removeImage(r){this.monumentForm.patchValue({[r]:null}),this.monumentForm.get(r)?.updateValueAndValidity(),delete this.imagePreviews[r];let t=document.getElementById(r);t&&(t.value="")}};s.\u0275fac=function(t){return new(t||s)(M(K))},s.\u0275cmp=H({type:s,selectors:[["app-editar"]],standalone:!0,features:[N],decls:65,vars:16,consts:[[1,"container","mt-5"],[3,"ngSubmit","formGroup"],[1,"row"],[1,"col-md-6"],[1,"mb-3"],["for","image",1,"form-label"],["type","file","id","image",1,"form-control",3,"change"],["class","mt-2",4,"ngIf"],["class","text-danger",4,"ngIf"],["for","carousel1",1,"form-label"],["type","file","id","carousel1",1,"form-control",3,"change"],["for","carousel2",1,"form-label"],["type","file","id","carousel2",1,"form-control",3,"change"],["for","carousel3",1,"form-label"],["type","file","id","carousel3",1,"form-control",3,"change"],["for","history",1,"form-label"],["id","history","rows","3","formControlName","history",1,"form-control"],["for","address",1,"form-label"],["type","text","id","address","formControlName","address",1,"form-control"],["for","entryFee",1,"form-label"],["type","text","id","entryFee","formControlName","entryFee",1,"form-control"],["for","openingHours",1,"form-label"],["id","openingHours","rows","3","formControlName","openingHours",1,"form-control"],[1,"mt-3"],["type","text","id","titulo","formControlName","titulo",1,"form-control"],["for","descricao",1,"form-label"],["id","descricao","rows","3","formControlName","descricao",1,"form-control"],["type","submit",1,"btn","btn-primary",3,"disabled"],[1,"mt-2"],[1,"img-thumbnail",2,"max-height","100px",3,"src"],["type","button",1,"btn","btn-danger","btn-sm",3,"click"],[1,"text-danger"]],template:function(t,e){if(t&1&&(i(0,"div",0)(1,"h1"),a(2,"Edi\xE7\xE3o do Monumento"),n(),i(3,"form",1),h("ngSubmit",function(){return e.onSubmit()}),i(4,"div",2)(5,"div",3)(6,"div",4)(7,"label",5),a(8,"Imagem-Capa:"),n(),i(9,"input",6),h("change",function(d){return e.onFileChange(d,"image")}),n(),v(10,Y,4,1,"div",7)(11,Z,2,0,"div",8),n(),i(12,"div",4)(13,"label",9),a(14,"Carrosel-1:"),n(),i(15,"input",10),h("change",function(d){return e.onFileChange(d,"carousel1")}),n(),v(16,$,4,1,"div",7)(17,ee,2,0,"div",8),n(),i(18,"div",4)(19,"label",11),a(20,"Carrosel-2:"),n(),i(21,"input",12),h("change",function(d){return e.onFileChange(d,"carousel2")}),n(),v(22,te,4,1,"div",7)(23,ne,2,0,"div",8),n(),i(24,"div",4)(25,"label",13),a(26,"Carrosel-3:"),n(),i(27,"input",14),h("change",function(d){return e.onFileChange(d,"carousel3")}),n(),v(28,ie,4,1,"div",7)(29,oe,2,0,"div",8),n(),i(30,"div",4)(31,"label",15),a(32,"Hist\xF3rico do Monumento:"),n(),f(33,"textarea",16),v(34,re,2,0,"div",8),n()(),i(35,"div",3)(36,"div",4)(37,"label",17),a(38,"Endere\xE7o:"),n(),f(39,"input",18),v(40,ae,2,0,"div",8),n(),i(41,"div",4)(42,"label",19),a(43,"Entrada:"),n(),f(44,"input",20),v(45,le,2,0,"div",8),n(),i(46,"div",4)(47,"label",21),a(48,"Hor\xE1rio de Funcionamento:"),n(),f(49,"textarea",22),v(50,me,2,0,"div",8),n(),i(51,"h3",23),a(52,"Informa\xE7\xF5es do Card:"),n(),i(53,"div",4)(54,"label",19),a(55,"T\xEDtulo:"),n(),f(56,"input",24),v(57,ue,2,0,"div",8),n(),i(58,"div",4)(59,"label",25),a(60,"Descri\xE7\xE3o:"),n(),f(61,"textarea",26),v(62,se,2,0,"div",8),n()()(),i(63,"button",27),a(64,"Salvar"),n()()()),t&2){let l,d,p,E,F,g,y,C,S,x;m(3),u("formGroup",e.monumentForm),m(7),u("ngIf",e.imagePreviews.image),m(),u("ngIf",((l=e.monumentForm.get("image"))==null?null:l.invalid)&&(((l=e.monumentForm.get("image"))==null?null:l.dirty)||((l=e.monumentForm.get("image"))==null?null:l.touched))),m(5),u("ngIf",e.imagePreviews.carousel1),m(),u("ngIf",((d=e.monumentForm.get("carousel1"))==null?null:d.invalid)&&(((d=e.monumentForm.get("carousel1"))==null?null:d.dirty)||((d=e.monumentForm.get("carousel1"))==null?null:d.touched))),m(5),u("ngIf",e.imagePreviews.carousel2),m(),u("ngIf",((p=e.monumentForm.get("carousel2"))==null?null:p.invalid)&&(((p=e.monumentForm.get("carousel2"))==null?null:p.dirty)||((p=e.monumentForm.get("carousel2"))==null?null:p.touched))),m(5),u("ngIf",e.imagePreviews.carousel3),m(),u("ngIf",((E=e.monumentForm.get("carousel3"))==null?null:E.invalid)&&(((E=e.monumentForm.get("carousel3"))==null?null:E.dirty)||((E=e.monumentForm.get("carousel3"))==null?null:E.touched))),m(5),u("ngIf",((F=e.monumentForm.get("history"))==null?null:F.invalid)&&(((F=e.monumentForm.get("history"))==null?null:F.dirty)||((F=e.monumentForm.get("history"))==null?null:F.touched))),m(6),u("ngIf",((g=e.monumentForm.get("address"))==null?null:g.invalid)&&(((g=e.monumentForm.get("address"))==null?null:g.dirty)||((g=e.monumentForm.get("address"))==null?null:g.touched))),m(5),u("ngIf",((y=e.monumentForm.get("entryFee"))==null?null:y.invalid)&&(((y=e.monumentForm.get("entryFee"))==null?null:y.dirty)||((y=e.monumentForm.get("entryFee"))==null?null:y.touched))),m(5),u("ngIf",((C=e.monumentForm.get("openingHours"))==null?null:C.invalid)&&(((C=e.monumentForm.get("openingHours"))==null?null:C.dirty)||((C=e.monumentForm.get("openingHours"))==null?null:C.touched))),m(7),u("ngIf",((S=e.monumentForm.get("titulo"))==null?null:S.invalid)&&(((S=e.monumentForm.get("titulo"))==null?null:S.dirty)||((S=e.monumentForm.get("titulo"))==null?null:S.touched))),m(5),u("ngIf",((x=e.monumentForm.get("descricao"))==null?null:x.invalid)&&(((x=e.monumentForm.get("descricao"))==null?null:x.dirty)||((x=e.monumentForm.get("descricao"))==null?null:x.touched))),m(),u("disabled",e.monumentForm.invalid)}},dependencies:[Q,j,z,G,O,L,J,R,U,k]});let o=s;return o})();export{ye as EditarComponent};
